upstreams:
  - id: 1
    nodes:
      "nginx:8073": 1
    type: roundrobin

routes:
  - id: 1
    name: "ue-default"
    desc: "System routes that require OIDC authentication."
    priority: 1
    upstream_id: 1
    plugins:
      openid-connect:
        client_id: ${{KEYCLOAK_CLIENT_ID}}
        client_secret: ${{KEYCLOAK_CLIENT_SECRET}}
        discovery: ${{KEYCLOAK_DISCOVERY_URL}}
        realm: ${{KEYCLOAK_REALM}}
        scope: "openid profile ol-profile"
        bearer_only: false
        introspection_endpoint_auth_method: "client_secret_post"
        ssl_verify: false
        logout_path: "/logout/"
        post_logout_redirect_uri: "http://ue.odl.local:9080/auth/logout/"
      cors:
        allow_origins: "**"
        allow_methods: "GET,POST,PUT,DELETE,OPTIONS"
        allow_headers: "**"
        allow_credential: true
      response-rewrite:
        headers:
          set:
            Referrer-Policy: "origin"
    host: "ue.odl.local"
    uris:
    - "/establish_session/*"
    - "/cart/*"
    - "/admin/*"
  - id: 2
    name: "ue-unauth"
    desc: "Everything else."
    priority: 0
    upstream_id: 1
    plugins:
      cors:
        allow_origins: "**"
        allow_methods: "GET,POST,PUT,DELETE,OPTIONS"
        allow_headers: "**"
        allow_credential: true
    host: "ue.odl.local"
    uris:
    - "*"

#END
